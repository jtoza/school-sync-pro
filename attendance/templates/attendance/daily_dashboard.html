{% extends 'base.html' %}
{% load static %}

{% block title %}Daily Attendance Dashboard{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="dashboard-header mb-4">
            <h1 class="h2 mb-1">Daily Attendance</h1>
            <p class="text-muted">Manage today's attendance records</p>
        </div>

        <!-- Stats Cards -->
        <div class="row">
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card stat-card stat-card-primary">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <div class="ml-3">
                                <h5 class="stat-value">{{ today|date:"F j, Y" }}</h5>
                                <span class="stat-label">Today's Date</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card stat-card stat-card-success">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="stat-icon">
                                <i class="fas fa-clipboard-check"></i>
                            </div>
                            <div class="ml-3">
                                <h5 class="stat-value">{{ registers_today }}</h5>
                                <span class="stat-label">Completed Today</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card stat-card stat-card-warning">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="ml-3">
                                <h5 class="stat-value">{{ pending_today }}</h5>
                                <span class="stat-label">Pending Today</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card stat-card stat-card-info">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="ml-3">
                                <h5 class="stat-value">{{ total_classes }}</h5>
                                <span class="stat-label">Total Classes</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Today's Registers -->
            <div class="col-lg-8 mb-4">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Today's Attendance Registers</h5>
                        <a href="{% url 'attendance:register_create' %}" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus mr-1"></i>New Register
                        </a>
                    </div>
                    <div class="card-body">
                        {% if today_registers %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Class</th>
                                        <th>Time</th>
                                        <th>Status</th>
                                        <th>Attendance</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for register in today_registers %}
                                    <tr>
                                        <td>
                                            <strong>{{ register.student_class }}</strong>
                                            <br>
                                            <small class="text-muted">{{ register.term }} • {{ register.session }}</small>
                                        </td>
                                        <td>
                                            <small>{{ register.created_at|time }}</small>
                                        </td>
                                        <td>
                                            {% if register.is_locked %}
                                            <span class="badge badge-success">Completed</span>
                                            {% else %}
                                            <span class="badge badge-warning">In Progress</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="attendance-mini-stats">
                                                <span class="text-success">{{ register.present_count }}P</span>
                                                <span class="text-danger">{{ register.absent_count }}A</span>
                                                <span class="text-warning">{{ register.late_count }}L</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <a href="{% url 'attendance:take_attendance' register.pk %}" 
                                                   class="btn btn-outline-primary" 
                                                   title="Take Attendance">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                <a href="{% url 'attendance:register_detail' register.pk %}" 
                                                   class="btn btn-outline-info" 
                                                   title="View Details">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
                            <h5>No Registers Today</h5>
                            <p class="text-muted">No attendance registers have been created for today yet.</p>
                            <a href="{% url 'attendance:register_create' %}" class="btn btn-primary">
                                <i class="fas fa-plus mr-1"></i>Create First Register
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Quick Actions & Recent -->
            <div class="col-lg-4">
                <!-- Quick Actions -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="{% url 'attendance:register_create' %}" class="btn btn-primary">
                                <i class="fas fa-plus-circle mr-2"></i>Create New Register
                            </a>
                            <a href="{% url 'attendance:bulk_register_create' %}" class="btn btn-outline-primary">
                                <i class="fas fa-layer-group mr-2"></i>Bulk Create
                            </a>
                            <a href="{% url 'attendance:register_list' %}" class="btn btn-outline-secondary">
                                <i class="fas fa-list mr-2"></i>View All Registers
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Recent Activity</h5>
                    </div>
                    <div class="card-body">
                        {% if recent_registers %}
                        <div class="activity-feed">
                            {% for register in recent_registers %}
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-clipboard-check"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">
                                        {{ register.student_class }}
                                    </div>
                                    <div class="activity-meta">
                                        {{ register.date }} • {{ register.present_count }}/{{ register.total_students }} present
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-muted text-center">No recent activity</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block morejs %}
<style>
.stat-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-card-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
.stat-card-success { background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%); color: white; }
.stat-card-warning { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
.stat-card-info { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }

.stat-icon {
    width: 60px;
    height: 60px;
    background: rgba(255,255,255,0.2);
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
}

.stat-label {
    font-size: 0.85rem;
    opacity: 0.9;
}

.attendance-mini-stats {
    font-size: 0.8rem;
    font-weight: 500;
}

.activity-feed {
    max-height: 300px;
    overflow-y: auto;
}

.activity-item {
    display: flex;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid #f8f9fa;
}

.activity-item:last-child {
    border-bottom: none;
}

.activity-icon {
    width: 40px;
    height: 40px;
    background: #f8f9fa;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
    color: #6c757d;
}

.activity-title {
    font-weight: 600;
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
}

.activity-meta {
    font-size: 0.8rem;
    color: #6c757d;
}

.dashboard-header {
    padding: 1rem 0;
}

.btn-group-sm > .btn {
    padding: 0.25rem 0.5rem;
}
</style>
{% endblock %}