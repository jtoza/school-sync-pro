{% extends 'base.html' %}

{% block title %}Bulk Upload{% endblock title %}

{% block content %}
<div class="card">
  <div class="card-header bg-info text-white">
    <h5 class="card-title mb-0">
      <i class="fas fa-upload mr-2"></i>
      Bulk Student Upload
    </h5>
  </div>
  
  <div class="card-body">
    <!-- Instructions -->
    <div class="alert alert-info mb-4">
      <div class="d-flex">
        <i class="fas fa-info-circle fa-lg mt-1 mr-3"></i>
        <div>
          <h6 class="alert-heading mb-2">Upload Instructions</h6>
          <ol class="mb-0 small">
            <li><a href="{% url 'download-csv' %}" class="fw-bold text-dark">Download CSV template</a></li>
            <li>Fill in student information</li>
            <li>Upload completed file below</li>
            <li class="text-danger fw-bold">Do not edit the first row</li>
          </ol>
        </div>
      </div>
    </div>

    <!-- Upload Form -->
    <form method="POST" enctype="multipart/form-data" id="upload-form">
      {% csrf_token %}
      
      <div class="mb-4">
        <label class="form-label fw-bold small">Select CSV File</label>
        <div class="custom-file">
          {{ form.csv_file }}
          <label class="custom-file-label text-truncate" for="{{ form.csv_file.id_for_label }}">
            Choose file...
          </label>
        </div>
        {% if form.csv_file.errors %}
          <div class="text-danger small mt-1">
            {% for error in form.csv_file.errors %}
              <i class="fas fa-exclamation-circle mr-1"></i>{{ error }}
            {% endfor %}
          </div>
        {% endif %}
        <div class="form-text">
          CSV files only â€¢ Max 5MB
        </div>
      </div>

      <div class="d-grid gap-2 d-md-flex">
        <a href="{% url 'student-list' %}" class="btn btn-outline-secondary flex-fill">
          <i class="fas fa-arrow-left mr-1"></i> Back
        </a>
        <button type="submit" class="btn btn-success flex-fill" id="submit-btn">
          <i class="fas fa-upload mr-1"></i> Upload
        </button>
      </div>
    </form>
  </div>
</div>

<style>
.alert {
  border-left: 4px solid #17a2b8;
  font-size: 0.875rem;
}

.custom-file-label {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  padding: 0.5rem 0.75rem;
  font-size: 0.875rem;
}

.custom-file-label::after {
  content: "Browse";
  background: #e9ecef;
  border-left: 1px solid #dee2e6;
}

.form-text {
  font-size: 0.75rem;
}

/* Mobile optimizations */
@media (max-width: 576px) {
  .card-body {
    padding: 1rem;
  }
  
  .alert {
    padding: 0.75rem;
  }
  
  .d-grid {
    gap: 0.5rem;
  }
  
  .btn {
    padding: 0.75rem;
    font-size: 0.875rem;
  }
}

/* Ensure touch-friendly file input */
.custom-file-input {
  min-height: 44px;
}

.custom-file-label {
  min-height: 44px;
  display: flex;
  align-items: center;
}
</style>

<script>
// File input label update
document.querySelector('.custom-file-input').addEventListener('change', function(e) {
  var fileName = e.target.files[0]?.name || 'Choose file...';
  var label = e.target.nextElementSibling;
  label.textContent = fileName;
});

// Form submission loading state
document.getElementById('upload-form').addEventListener('submit', function() {
  const submitBtn = document.getElementById('submit-btn');
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i> Uploading...';
});

// Better touch handling
document.addEventListener('touchstart', function() {}, {passive: true});
</script>
{% endblock content %}