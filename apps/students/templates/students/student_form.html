{% extends 'base.html' %}
{% load widget_tweaks %}

{% block title %}
  {% if object %}Update Student{% else %}Add Student{% endif %}
{% endblock title %}

{% block content %}
<div class="card">
  <div class="card-header bg-primary text-white py-3">
    <h5 class="card-title mb-0">
      <i class="fas fa-user-graduate me-2"></i>
      {% if object %}
        Update Student
      {% else %}
        Add New Student
      {% endif %}
    </h5>
  </div>

  <form action="" method="POST" enctype="multipart/form-data" id="student-form">
    {% csrf_token %}
    
    <div class="card-body">
      <!-- Basic Information -->
      <div class="form-section mb-4">
        <h6 class="text-primary mb-3 border-bottom pb-2">
          <i class="fas fa-user me-2"></i>
          Basic Information
        </h6>
        {% include 'corecode/form_snippet.html' %}
      </div>

      <!-- Guardian & Contacts -->
      <div class="card mb-4 border-0 shadow-sm">
        <div class="card-header bg-light py-3">
          <h6 class="card-title mb-0 text-dark">
            <i class="fas fa-users me-2 text-info"></i>
            Guardian & Contact Information
          </h6>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label class="form-label fw-medium">{{ form.guardian_name.label }}</label>
              {{ form.guardian_name|add_class:"form-control" }}
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label fw-medium">{{ form.relationship.label }}</label>
              {{ form.relationship|add_class:"form-select" }}
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label fw-medium">{{ form.guardian_phone.label }}</label>
              {{ form.guardian_phone|add_class:"form-control" }}
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label fw-medium">{{ form.guardian_email.label }}</label>
              {{ form.guardian_email|add_class:"form-control" }}
            </div>
            <div class="col-12">
              <label class="form-label fw-medium">{{ form.emergency_contact.label }}</label>
              {{ form.emergency_contact|add_class:"form-control" }}
            </div>
            <div class="col-12">
              <div class="form-check">
                {{ form.pickup_authorized|add_class:"form-check-input" }}
                <label class="form-check-label fw-medium" for="{{ form.pickup_authorized.id_for_label }}">
                  {{ form.pickup_authorized.label }}
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Medical Information -->
      <div class="card mb-4 border-0 shadow-sm">
        <div class="card-header bg-light py-3">
          <h6 class="card-title mb-0 text-dark">
            <i class="fas fa-heartbeat me-2 text-warning"></i>
            Medical Information
          </h6>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label fw-medium">{{ form.medical_notes.label }}</label>
              {{ form.medical_notes|add_class:"form-control"|attr:"rows:3" }}
              <div class="form-text text-muted mt-1">Any important medical information</div>
            </div>
            <div class="col-12">
              <label class="form-label fw-medium">{{ form.allergies.label }}</label>
              {{ form.allergies|add_class:"form-control"|attr:"rows:2" }}
              <div class="form-text text-muted mt-1">List any known allergies</div>
            </div>
          </div>
        </div>
      </div>

      <!-- House & Services -->
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-light py-3">
          <h6 class="card-title mb-0 text-dark">
            <i class="fas fa-home me-2 text-success"></i>
            House & Services
          </h6>
        </div>
        <div class="card-body">
          <div class="row g-3 align-items-center">
            <div class="col-12 col-md-4">
              <label class="form-label fw-medium">{{ form.house.label }}</label>
              {{ form.house|add_class:"form-select" }}
            </div>
            <div class="col-12 col-md-4">
              <div class="form-check form-switch">
                {{ form.transport_opt_in|add_class:"form-check-input" }}
                <label class="form-check-label fw-medium" for="{{ form.transport_opt_in.id_for_label }}">
                  {{ form.transport_opt_in.label }}
                </label>
              </div>
            </div>
            <div class="col-12 col-md-4">
              <div class="form-check form-switch">
                {{ form.lunch_opt_in|add_class:"form-check-input" }}
                <label class="form-check-label fw-medium" for="{{ form.lunch_opt_in.id_for_label }}">
                  {{ form.lunch_opt_in.label }}
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card-footer bg-light py-3">
      <div class="d-flex flex-column flex-sm-row gap-2 justify-content-end">
        <a href="{% if object %}{% url 'students:student-detail' object.id %}{% else %}{% url 'students:student-list' %}{% endif %}" 
   class="btn btn-outline-secondary order-2 order-sm-1">
           class="btn btn-outline-secondary order-2 order-sm-1">
          <i class="fas fa-times me-1"></i> Cancel
        </a>
        <button type="submit" class="btn btn-success order-1 order-sm-2" id="submit-btn">
          <i class="fas fa-save me-1"></i>
          {% if object %}
            Update Student
          {% else %}
            Save Student
          {% endif %}
        </button>
      </div>
    </div>
  </form>
</div>

<style>
/* Improved form styling */
.form-control, .form-select {
  border: 1px solid #dee2e6;
  border-radius: 0.375rem;
  padding: 0.75rem;
  font-size: 0.9rem;
  transition: all 0.2s ease;
}

.form-control:focus, .form-select:focus {
  border-color: #007bff;
  box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.1);
}

.form-label {
  font-size: 0.9rem;
  margin-bottom: 0.5rem;
  color: #495057;
}

.form-text {
  font-size: 0.8rem;
}

.card {
  border: none;
  border-radius: 0.5rem;
  overflow: hidden;
}

.card-header {
  border-bottom: 1px solid #dee2e6;
}

.card-header.bg-light {
  background-color: #f8f9fa !important;
}

.btn {
  padding: 0.75rem 1.5rem;
  font-weight: 500;
  border-radius: 0.375rem;
  font-size: 0.9rem;
}

/* Form switches */
.form-switch .form-check-input {
  width: 3em;
  height: 1.5em;
  margin-right: 0.5rem;
}

.form-switch .form-check-input:checked {
  background-color: #198754;
  border-color: #198754;
}

/* Section headers */
.border-bottom {
  border-color: #e9ecef !important;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
  .card-body {
    padding: 1rem;
  }
  
  .card-header, .card-footer {
    padding: 1rem;
  }
  
  .btn {
    width: 100%;
  }
  
  .d-flex.flex-column .btn {
    margin-bottom: 0.5rem;
  }
  
  .d-flex.flex-column .btn:last-child {
    margin-bottom: 0;
  }
  
  .form-control, .form-select {
    padding: 0.875rem;
  }
}

/* Touch-friendly elements */
.form-control, .form-select, .btn {
  min-height: 48px;
}

/* Shadow for cards */
.shadow-sm {
  box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075) !important;
}
</style>

<script>
document.getElementById('student-form').addEventListener('submit', function() {
    const submitBtn = document.getElementById('submit-btn');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Saving...';
});

// Enhance form usability
document.addEventListener('DOMContentLoaded', function() {
    // Auto-focus first field
    const firstInput = document.querySelector('form input:not([type="hidden"])');
    if (firstInput) {
        firstInput.focus();
    }
    
    // Add form-select class to all select elements
    const selects = document.querySelectorAll('select');
    selects.forEach(select => {
        if (!select.classList.contains('form-select')) {
            select.classList.add('form-select');
        }
    });
});
</script>
{% endblock content %}