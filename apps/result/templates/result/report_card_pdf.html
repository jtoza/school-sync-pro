{% load humanize static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Report Card - {{ student }}</title>
<style>
  @page { size: A4; margin: 16mm 14mm; }
  body { font-family: DejaVu Sans, Arial, sans-serif; font-size: 12px; color: #222; }
  .container { max-width: 100%; }
  .header { display: flex; align-items: center; border-bottom: 2px solid #2c3e50; padding-bottom: 8px; margin-bottom: 10px; }
  .logo { width: 58px; height: 58px; margin-right: 10px; }
  .school { font-size: 18px; font-weight: 700; color: #2c3e50; }
  .meta { font-size: 12px; color: #555; }
  .title { text-align: center; font-size: 15px; font-weight: 700; margin: 10px 0; color: #2c3e50; }
  table { width: 100%; border-collapse: collapse; margin-top: 6px; table-layout: fixed; }
  th, td { border: 1px solid #999; padding: 5px 6px; }
  thead th { background: #ecf0f1; text-transform: uppercase; font-size: 11px; letter-spacing: .3px; }
  tbody tr:nth-child(odd) { background: #fafbfc; }
  tfoot th, tfoot td { background: #f8f9fa; font-weight: bold; }
  .grid { display: flex; gap: 10px; margin-top: 10px; }
  .card { border: 1px solid #999; padding: 8px 10px; border-radius: 4px; flex: 1; }
  .card h4 { margin: 0 0 6px; font-size: 13px; color: #2c3e50; }
  .muted { color: #555; }
  .footer { margin-top: 14px; font-size: 11px; color: #555; display: flex; justify-content: space-between; align-items: center; }
  .sign { width: 44%; border-top: 1px solid #aaa; text-align: center; padding-top: 4px; }
  .qr { width: 80px; height: 80px; }
</style>
</head>
<body>
  <div class="header">
    <img class="logo" src="{% static 'dist/img/icon-192x192.png' %}" alt="logo">
    <div>
      <div class="school">{{ school_name|default:'EduSync School' }}</div>
      <div class="meta">{{ term }} {{ session }} | {{ current_class }} | {{ student.registration_number }} — {{ student }}</div>
    </div>
  </div>

  <div class="title">ACADEMIC REPORT CARD</div>

  <table>
    <thead>
      <tr>
        <th>Subject</th>
        <th>CA (40)</th>
        <th>Exam (60)</th>
        <th>Total</th>
        <th>Grade</th>
        <th>Remark</th>
      </tr>
    </thead>
    <tbody>
      {% for r in results %}
      <tr>
        <td>{{ r.subject }}</td>
        <td>{{ r.test_score|floatformat:0 }}</td>
        <td>{{ r.exam_score|floatformat:0 }}</td>
        <td>{{ r.total_score|floatformat:0 }}</td>
        <td>{{ r.grade }}</td>
        <td>{{ r.remarks }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="6" class="muted" style="text-align:center; padding:10px;">No results available</td></tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <th colspan="3" style="text-align:right;">Average Total</th>
        <td colspan="3">{{ average_total|floatformat:2 }}</td>
      </tr>
    </tfoot>
  </table>

  <div class="grid">
    <div class="card">
      <h4>Attendance Summary</h4>
      <div>Present: <strong>{{ attendance.present }}</strong></div>
      <div>Absent: <strong>{{ attendance.absent }}</strong></div>
      <div>Late: <strong>{{ attendance.late }}</strong></div>
      <div>Attendance: <strong>{{ attendance.percent|default:0 }}%</strong></div>
    </div>
    <div class="card">
      <h4>Teacher's Comment</h4>
      <div class="muted">{{ teacher_comment|default:'—' }}</div>
    </div>
    <div class="card">
      <h4>Headteacher's Comment</h4>
      <div class="muted">{{ headteacher_comment|default:'—' }}</div>
    </div>
  </div>

  <div class="grid" style="margin-top: 10px;">
    <div class="card">
      <h4>Outstanding Balance</h4>
      <div><strong>{{ fee_balance|floatformat:2 }}</strong></div>
    </div>
    <div class="card">
      <h4>Summary</h4>
      <div class="muted">Term: {{ term }} | Session: {{ session }}</div>
    </div>
  </div>

  <div class="footer">
    <div class="sign">Class Teacher Signature / Date</div>
    <div class="sign">Headteacher Signature / Date</div>
  </div>
</body>
</html>