{% extends 'base.html' %}

{% block title %}
Select Students for Results
{% endblock title %}

{% block content %}
<div class="card">
  <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
    <div>
      <h5 class="card-title mb-0">
        <i class="fas fa-users me-2"></i>
        Select Students for Results
      </h5>
      <small class="opacity-75">Select students and click proceed</small>
    </div>
    <form method="POST" class="mb-0">
      {% csrf_token %}
      <button type="submit" class="btn btn-success">
        <i class="fas fa-arrow-right me-1"></i> Proceed
      </button>
    </form>
  </div>
  
  <div class="card-body">
    <div class="alert alert-info d-flex align-items-center">
      <i class="fas fa-info-circle me-2"></i>
      <small>You can search by name or class using the search box below</small>
    </div>

    <form method="POST">
      {% csrf_token %}
      <table id="studenttable" class="table table-sm table-hover" data-page-length='100'>
        <thead class="table-light">
          <tr>
            <th style="width: 50px;">
              <input type="checkbox" id="selectall" class="form-check-input">
            </th>
            <th>Student Name</th>
            <th>Registration Number</th>
            <th>Current Class</th>
          </tr>
        </thead>
        <tbody>
          {% for student in students %}
            <tr>
              <td>
                <input type="checkbox" id="student_{{ student.id }}" name="students" 
                       value="{{ student.id }}" class="form-check-input student-checkbox">
              </td>
              <td class="fw-medium">{{ student.get_full_name|default:student }}</td>
              <td class="text-muted">{{ student.registration_number|default:"â€”" }}</td>
              <td>
                <span class="badge bg-secondary">{{ student.current_class }}</span>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="4" class="text-center py-4 text-muted">
                <i class="fas fa-users fa-2x mb-2 d-block"></i>
                No students found
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="mt-3 text-center">
        <button type="submit" class="btn btn-success btn-lg px-5">
          <i class="fas fa-arrow-right me-2"></i>
          Proceed to Next Step
        </button>
      </div>
    </form>
  </div>
</div>

<style>
.table th {
  font-weight: 600;
  font-size: 0.9rem;
}

.student-checkbox {
  transform: scale(1.1);
}

#selectall {
  transform: scale(1.2);
}

.badge {
  font-size: 0.75rem;
}

@media (max-width: 768px) {
  .btn-lg {
    width: 100%;
  }
  
  .card-header .d-flex {
    flex-direction: column;
    text-align: center;
  }
  
  .card-header .btn {
    margin-top: 0.5rem;
    width: 100%;
  }
}
</style>

{% endblock content %}

{% block morejs %}
<script>
$(document).ready(function() {
  $('#studenttable').DataTable({
    "ordering": false,
    "responsive": true,
    "language": {
      "search": "Search students:",
      "zeroRecords": "No matching students found"
    }
  });

  // Select all functionality
  $("#selectall").change(function() {
    $('.student-checkbox').prop('checked', this.checked);
  });

  // Update select all checkbox when individual checkboxes change
  $('.student-checkbox').change(function() {
    if (!this.checked) {
      $("#selectall").prop('checked', false);
    } else {
      if ($('.student-checkbox:checked').length === $('.student-checkbox').length) {
        $("#selectall").prop('checked', true);
      }
    }
  });
});
</script>
{% endblock morejs %}